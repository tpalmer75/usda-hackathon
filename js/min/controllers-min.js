angular.module("lunch.controllers",[]).controller("MainCtrl",function(n,e,a,i,s,t){e.newSubmission={},e.formSubmitted=!1,e.currentPersonInfo={},e.showModal=!1;var o=new Date;e.filteredDate=s("date")(o,"MMM dd, y");var r=[];e.firebaseRef=t.all(),e.frequencyValues=[{name:"Weekly",id:52},{name:"Bi-weekly",id:26},{name:"2x per month",id:24},{name:"Monthly",id:12},{name:"Yearly",id:1}];var l=function(){r=[],e.newSubmission={children:[{firstName:"",middleInitial:"",lastName:"",fosterChild:null,homelessMigrantRunaway:null,student:null}],adults:[{firstName:"",middleInitial:"",lastName:""}],date:e.filteredDate,primaryWageEarner:null,totalIncome:0,signature:null,programs:null,caseNumber:null,ssn:"",contact:{address:"",apt:"",city:"",state:"",zip:"",phone:"",email:""},latino:!1,indianOrAlaskan:!1,asian:!1,blackOrAfrican:!1,hawaiianOrIslander:!1,white:!1}};l(),e.addPerson=function(n){var a={firstName:"",middleInitial:"",lastName:""};switch(n){case"child":e.newSubmission.children.push(a);break;case"adult":e.newSubmission.adults.push(a)}};var c=function(){for(var n={},a=e.newSubmission,i=0;i<e.newSubmission.children.length;i++){var s=e.newSubmission.children[i];n={signature:a.signature,type:"child",programs:a.programs,caseNumber:a.caseNumber,firstName:s.firstName,middleInitial:s.middleInitial,lastName:s.lastName,income:a.totalIncome,student:s.student,homelessMigrantRunaway:s.homelessMigrantRunaway,fosterChild:s.fosterChild,street:a.contact.address,apt:a.contact.apt,city:a.contact.city,state:a.contact.state,zip:a.contact.zip,phone:a.contact.phone,date:a.date,hispanic:a.latino,indianOrAlaskan:a.indianOrAlaskan,asian:a.asian,blackOrAfrican:a.blackOrAfrican,hawaiianOrIslander:a.hawaiianOrIslander,white:a.white,social:a.ssn},r.push(n)}if(a.programs===!1)for(var i=0;i<e.newSubmission.adults.length;i++){var s=e.newSubmission.adults[i];n={signature:a.signature,type:"adult",programs:a.programs,caseNumber:a.caseNumber,firstName:s.firstName,middleInitial:s.middleInitial,lastName:s.lastName,income:a.totalIncome,student:"",homelessMigrantRunaway:"",fosterChild:"",street:a.contact.address,apt:a.contact.apt,city:a.contact.city,state:a.contact.state,zip:a.contact.zip,phone:a.contact.phone,date:a.date,hispanic:"",indianOrAlaskan:"",asian:"",blackOrAfrican:"",hawaiianOrIslander:"",white:"",social:a.ssn},r.push(n)}};e.goBack=function(){window.history.back()},n.$on("$stateChangeSuccess",function(n,s,t,o){e.currentPerson=i.idx;var r=s.name,c=o.name;"adult-individual"===r?e.currentPersonInfo=e.newSubmission.adults[e.currentPerson]:"child-individual"===r?e.currentPersonInfo=e.newSubmission.children[e.currentPerson]:"finish"===c&&"export"!=r&&(a.go("home"),l())}),e.goNext=function(n){if(n){switch(a.current.name){case"intro":a.go("legal");break;case"legal":a.go("sign");break;case"sign":a.go("programs");break;case"programs":if(e.newSubmission.programs===!0)for(s=0;s<e.newSubmission.children.length;s++)e.newSubmission.children[s].fosterChild="",e.newSubmission.children[s].homelessMigrantRunaway="";a.go("child-add");break;case"child-add":a.go("child-individual",{idx:0});break;case"child-individual":if(e.currentPerson++,e.newSubmission.children[e.currentPerson])a.go("child-individual",{idx:e.currentPerson});else if(e.newSubmission.programs)a.go("contact");else{for(var i=!0,s=0;s<e.newSubmission.children.length;s++){var t=e.newSubmission.children[s].fosterChild,o=e.newSubmission.children[s].homelessMigrantRunaway;t||o||(i=!1)}i?a.go("contact"):a.go("adult-add")}break;case"adult-add":a.go("adult-individual",{idx:0});break;case"adult-individual":if(e.currentPerson++,e.newSubmission.adults[e.currentPerson])a.go("adult-individual",{idx:e.currentPerson});else{for(var l=0,d=0;d<e.newSubmission.adults.length;d++){var u=e.newSubmission.adults[d],m=e.newSubmission.adults[d].workIncomeAmount*e.newSubmission.adults[d].workIncomeFrequency;m>l&&m>0&&(l=m,e.newSubmission.primaryWageEarner=u.firstName)}a.go("household");for(var s=0;s<e.newSubmission.children.length;s++){var h=e.newSubmission.children[s].incomeAmount*e.newSubmission.children[s].incomeFrequency;h&&(e.newSubmission.totalIncome=h)}for(var s=0;s<e.newSubmission.adults.length;s++){var b=e.newSubmission.adults[s].workIncomeAmount*e.newSubmission.adults[s].workIncomeFrequency,w=e.newSubmission.adults[s].secondIncomeAmount*e.newSubmission.adults[s].secondIncomeFrequency;b&&(e.newSubmission.totalIncome+=b),w&&(e.newSubmission.totalIncome+=w),e.newSubmission.totalIncome||(e.newSubmission.totalIncome=0)}console.log(e.newSubmission.totalIncome)}break;case"household":var g=e.newSubmission.children.length+e.newSubmission.adults.length;if(e.newSubmission.household!==g)return;a.go("contact");break;case"contact":a.go("ethnicity");break;case"ethnicity":a.go("finish"),c(),console.log(r);for(var s=0;s<r.length;s++)e.firebaseRef.$add(r[s])}e.formSubmitted=!1,document.body.scrollTop=85}};var d=t.all();e.dataReady=!1,e.exportButton="Loading...",d.$loaded().then(function(){e.dataReady=!0,e.exportButton="Download CSV"})});